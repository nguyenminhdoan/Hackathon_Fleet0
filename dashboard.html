<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Fleet Predictive Maintenance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .header-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .auto-refresh-indicator {
            color: #90EE90;
            font-weight: bold;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .grid-full {
            grid-column: 1 / -1;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Metrics */
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-value {
            font-weight: 700;
            color: #333;
            font-size: 1.1em;
        }

        /* Alert Boxes */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
            font-size: 1.1em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .alert-critical {
            background: #fee;
            color: #c00;
            border: 2px solid #c00;
        }

        .alert-warning {
            background: #fffbcc;
            color: #996600;
            border: 2px solid #ff9900;
        }

        .alert-monitor {
            background: #e7f3ff;
            color: #0066cc;
            border: 2px solid #0099ff;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-critical { background: #f00; }
        .status-warning { background: #ff0; }
        .status-monitor { background: #00f; }
        .status-good { background: #0f0; }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #eee;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Manual Input Form */
        .form-group {
            margin: 15px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #666;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group small {
            color: #999;
            font-size: 0.85em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* Model Performance Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f5f5f5;
            font-weight: bold;
            color: #667eea;
        }

        tr:hover {
            background: #f9f9f9;
        }

        /* Chart Placeholder */
        .chart-container {
            height: 200px;
            background: #f5f5f5;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            margin: 15px 0;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .header-info {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöå EV Fleet Predictive Maintenance Dashboard</h1>
            <div class="header-info">
                <div class="header-badge">
                    <span id="timestamp">Loading...</span>
                </div>
                <div class="header-badge auto-refresh-indicator">
                    üîÑ Auto-refresh: <span id="countdown">15</span>s
                </div>
                <div class="header-badge">
                    üìç Data Index: <span id="data-index">--</span>
                </div>
                <div class="header-badge">
                    ü§ñ Model: <span id="model-type">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üî¥ LIVE: Real-Time Simulation</button>
            <button class="tab" onclick="switchTab('manual')">‚úçÔ∏è MANUAL: Test Prediction</button>
            <button class="tab" onclick="switchTab('analytics')">üìà Analytics</button>
            <button class="tab" onclick="switchTab('comparison')">üìä Model Comparison</button>
            <button class="tab" onclick="switchTab('model')">ü§ñ Model Info</button>
        </div>

        <!-- Tab: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <!-- AI Prediction (Featured) -->
                <div class="card" style="grid-column: span 2;">
                    <h2>ü§ñ AI Prediction</h2>
                    <div id="prediction-alert" class="alert alert-success">
                        Analyzing...
                    </div>
                    <div class="metric">
                        <span class="metric-label">Maintenance Probability:</span>
                        <span class="metric-value" id="pred-prob">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Decision Threshold:</span>
                        <span class="metric-value" id="threshold">30%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Confidence:</span>
                        <span class="metric-value" id="confidence">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Severity:</span>
                        <span class="metric-value" id="severity">--</span>
                    </div>

                    <h3 style="margin-top: 20px; color: #667eea; font-size: 1.2em;">üí∞ Cost Analysis</h3>
                    <div class="metric">
                        <span class="metric-label">Preventive Maintenance Cost:</span>
                        <span class="metric-value" id="cost-preventive" style="color: #0066cc;">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Expected Cost (No Action):</span>
                        <span class="metric-value" id="cost-no-action" style="color: #cc0000;">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Potential Savings:</span>
                        <span class="metric-value" id="cost-savings" style="color: #009900;">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">üí° Recommendation:</span>
                        <span class="metric-value" id="cost-recommendation" style="font-weight: bold;">--</span>
                    </div>
                </div>

                <!-- Battery Status -->
                <div class="card">
                    <h2>üîã Battery Status</h2>
                    <div class="metric">
                        <span class="metric-label">Voltage:</span>
                        <span class="metric-value" id="voltage">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Current:</span>
                        <span class="metric-value" id="current">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Temperature:</span>
                        <span class="metric-value" id="temperature">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">State of Charge (SoC):</span>
                        <span class="metric-value" id="soc">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">State of Health (SoH):</span>
                        <span class="metric-value" id="soh">--</span>
                    </div>
                </div>

                <!-- Health Status -->
                <div class="card">
                    <h2>üè• Health Status</h2>
                    <div class="metric">
                        <span class="metric-label">Component Health:</span>
                        <span class="metric-value" id="health">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Failure Probability:</span>
                        <span class="metric-value" id="failure-prob">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">RUL (Remaining Useful Life):</span>
                        <span class="metric-value" id="rul">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Maintenance Type:</span>
                        <span class="metric-value" id="maint-type">--</span>
                    </div>
                </div>

                <!-- Vehicle Status -->
                <div class="card">
                    <h2>üöó Vehicle Status</h2>
                    <div class="metric">
                        <span class="metric-label">Distance Traveled:</span>
                        <span class="metric-value" id="distance">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Power Consumption:</span>
                        <span class="metric-value" id="power">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Driving Speed:</span>
                        <span class="metric-value" id="speed">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Charge Cycles:</span>
                        <span class="metric-value" id="cycles">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Manual Prediction -->
        <div id="manual" class="tab-content">
            <div class="grid">
                <div class="card" style="grid-column: span 2;">
                    <h2>üîß Manual Prediction Test</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        Enter vehicle parameters to test the AI model prediction manually.
                    </p>

                    <form id="manual-form">
                        <div class="grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label>Battery Voltage (V)</label>
                                <input type="number" name="battery_voltage" step="0.01" value="370" required>
                                <small>Typical: 360-380V</small>
                            </div>

                            <div class="form-group">
                                <label>Battery Current (A)</label>
                                <input type="number" name="battery_current" step="0.01" value="50" required>
                                <small>Typical: -100 to 100A</small>
                            </div>

                            <div class="form-group">
                                <label>Battery Temperature (¬∞C)</label>
                                <input type="number" name="battery_temperature" step="0.1" value="25" required>
                                <small>Typical: 15-45¬∞C</small>
                            </div>

                            <div class="form-group">
                                <label>State of Charge (0-1)</label>
                                <input type="number" name="soc" step="0.01" min="0" max="1" value="0.8" required>
                                <small>0 = empty, 1 = full</small>
                            </div>

                            <div class="form-group">
                                <label>State of Health (0-1)</label>
                                <input type="number" name="soh" step="0.01" min="0" max="1" value="0.9" required>
                                <small>0 = degraded, 1 = new</small>
                            </div>

                            <div class="form-group">
                                <label>Charge Cycles</label>
                                <input type="number" name="charge_cycles" value="500" required>
                                <small>Total charging cycles</small>
                            </div>

                            <div class="form-group">
                                <label>Distance Traveled (km)</label>
                                <input type="number" name="distance_traveled" step="0.1" value="50000" required>
                                <small>Total kilometers</small>
                            </div>

                            <div class="form-group">
                                <label>Power Consumption (kWh)</label>
                                <input type="number" name="power_consumption" step="0.1" value="50" required>
                                <small>Current consumption</small>
                            </div>

                            <div class="form-group">
                                <label>Component Health Score (0-1)</label>
                                <input type="number" name="component_health_score" step="0.01" min="0" max="1" value="0.85" required>
                                <small>Overall component health</small>
                            </div>

                            <div class="form-group">
                                <label>Failure Probability (0-1)</label>
                                <input type="number" name="failure_probability" step="0.01" min="0" max="1" value="0.1" required>
                                <small>Risk of failure</small>
                            </div>

                            <div class="form-group">
                                <label>Remaining Useful Life (days)</label>
                                <input type="number" name="rul" step="0.1" value="30" required>
                                <small>Estimated days until maintenance</small>
                            </div>
                        </div>

                        <button type="submit" class="btn" style="margin-top: 20px;">
                            üöÄ Make Prediction
                        </button>
                    </form>

                    <div id="manual-result" style="margin-top: 30px; display: none;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">Prediction Result:</h3>
                        <div id="manual-alert" class="alert"></div>
                        <table>
                            <tr>
                                <th>Metric</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td>Maintenance Probability</td>
                                <td id="manual-prob">--</td>
                            </tr>
                            <tr>
                                <td>Maintenance Needed</td>
                                <td id="manual-needed">--</td>
                            </tr>
                            <tr>
                                <td>Severity</td>
                                <td id="manual-severity">--</td>
                            </tr>
                            <tr>
                                <td>Confidence</td>
                                <td id="manual-confidence">--</td>
                            </tr>
                            <tr>
                                <td>Recommendation</td>
                                <td id="manual-recommendation">--</td>
                            </tr>
                        </table>

                        <h3 style="color: #667eea; margin: 20px 0 15px 0;">üí∞ Cost Analysis:</h3>
                        <table>
                            <tr>
                                <th>Cost Item</th>
                                <th>Amount</th>
                            </tr>
                            <tr>
                                <td>Preventive Maintenance Cost</td>
                                <td id="manual-cost-preventive" style="color: #0066cc;">--</td>
                            </tr>
                            <tr>
                                <td>Expected Cost (No Action)</td>
                                <td id="manual-cost-no-action" style="color: #cc0000;">--</td>
                            </tr>
                            <tr>
                                <td><strong>Potential Savings</strong></td>
                                <td id="manual-cost-savings" style="font-weight: bold; color: #009900;">--</td>
                            </tr>
                            <tr>
                                <td><strong>üí° Recommendation</strong></td>
                                <td id="manual-cost-recommendation" style="font-weight: bold;">--</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Analytics -->
        <div id="analytics" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>üìä Dataset Progress</h2>
                    <div class="metric">
                        <span class="metric-label">Total Records:</span>
                        <span class="metric-value" id="analytics-total">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Current Index:</span>
                        <span class="metric-value" id="analytics-index">--</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="analytics-progress" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h2>üîã Battery Statistics (Recent)</h2>
                    <div class="metric">
                        <span class="metric-label">Avg Voltage:</span>
                        <span class="metric-value" id="analytics-voltage">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Temperature:</span>
                        <span class="metric-value" id="analytics-temp">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg SoC:</span>
                        <span class="metric-value" id="analytics-soc">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg SoH:</span>
                        <span class="metric-value" id="analytics-soh">--</span>
                    </div>
                </div>

                <div class="card">
                    <h2>üè• Health Statistics (Recent)</h2>
                    <div class="metric">
                        <span class="metric-label">Avg Component Health:</span>
                        <span class="metric-value" id="analytics-health">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Failure Probability:</span>
                        <span class="metric-value" id="analytics-fail-prob">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg RUL:</span>
                        <span class="metric-value" id="analytics-rul">--</span>
                    </div>
                </div>

                <div class="card">
                    <h2>üîß Maintenance Events (Recent)</h2>
                    <div class="metric">
                        <span class="metric-label">Total Events:</span>
                        <span class="metric-value" id="analytics-total-events">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Preventive (Type 1):</span>
                        <span class="metric-value" id="analytics-preventive">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Corrective (Type 2):</span>
                        <span class="metric-value" id="analytics-corrective">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Predictive (Type 3):</span>
                        <span class="metric-value" id="analytics-predictive">--</span>
                    </div>
                </div>

                <div class="card">
                    <h2>ü§ñ Prediction Statistics</h2>
                    <div class="metric">
                        <span class="metric-label">Total Predictions:</span>
                        <span class="metric-value" id="analytics-pred-count">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Probability:</span>
                        <span class="metric-value" id="analytics-avg-prob">--</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">High Risk Alerts:</span>
                        <span class="metric-value" id="analytics-high-risk">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Model Comparison -->
        <div id="comparison" class="tab-content">
            <div class="card" style="margin-bottom: 20px;">
                <h2>üìä Model Performance Comparison</h2>
                <p style="color: #666; margin-bottom: 15px;">
                    Comprehensive comparison of LSTM, GRU, and LSTM+Attention models trained on the EV maintenance dataset.
                </p>
                <div id="comparison-summary" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>Summary:</strong> <span id="comparison-summary-text">Loading comparison data...</span>
                </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr;">
                <!-- Metrics Comparison Chart -->
                <div class="card">
                    <h2>üéØ Key Metrics Comparison</h2>
                    <img src="metrics_comparison.png" alt="Metrics Comparison" style="width: 100%; height: auto; border-radius: 8px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect fill=\'%23f5f5f5\' width=\'800\' height=\'400\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'20\'%3EChart not available - Run generate_model_comparison_report.py%3C/text%3E%3C/svg%3E';">
                </div>

                <!-- Radar Chart -->
                <div class="card">
                    <h2>üåê Multi-Dimensional Performance</h2>
                    <img src="radar_comparison.png" alt="Radar Comparison" style="width: 100%; height: auto; border-radius: 8px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect fill=\'%23f5f5f5\' width=\'800\' height=\'400\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'20\'%3EChart not available%3C/text%3E%3C/svg%3E';">
                </div>

                <!-- Performance Heatmap -->
                <div class="card">
                    <h2>üî• Performance Heatmap</h2>
                    <img src="performance_heatmap.png" alt="Performance Heatmap" style="width: 100%; height: auto; border-radius: 8px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect fill=\'%23f5f5f5\' width=\'800\' height=\'400\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'20\'%3EChart not available%3C/text%3E%3C/svg%3E';">
                </div>

                <!-- Confusion Matrices -->
                <div class="card">
                    <h2>üé≤ Confusion Matrices Comparison</h2>
                    <img src="confusion_matrices_comparison.png" alt="Confusion Matrices" style="width: 100%; height: auto; border-radius: 8px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect fill=\'%23f5f5f5\' width=\'800\' height=\'400\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'20\'%3EChart not available%3C/text%3E%3C/svg%3E';">
                </div>

                <!-- Complexity vs Performance -->
                <div class="card">
                    <h2>‚öôÔ∏è Model Efficiency Analysis</h2>
                    <img src="complexity_vs_performance.png" alt="Complexity vs Performance" style="width: 100%; height: auto; border-radius: 8px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect fill=\'%23f5f5f5\' width=\'800\' height=\'400\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'20\'%3EChart not available%3C/text%3E%3C/svg%3E';">
                </div>

                <!-- Detailed Comparison Table -->
                <div class="card">
                    <h2>üìã Detailed Metrics Table</h2>
                    <div id="comparison-table-container">
                        <table id="comparison-table">
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Accuracy</th>
                                    <th>Precision</th>
                                    <th>Recall</th>
                                    <th>F1-Score</th>
                                    <th>AUC-ROC</th>
                                    <th>Parameters</th>
                                </tr>
                            </thead>
                            <tbody id="comparison-table-body">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #999;">
                                        Loading data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card">
                    <h2>üí° Model Selection Guide</h2>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #4caf50;">
                        <strong>üèÜ For Maximum Safety (Catch All Failures):</strong>
                        <p style="margin: 8px 0 0 0; color: #666;">Choose the model with highest <strong>Recall</strong> - ensures no maintenance events are missed.</p>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ff9800;">
                        <strong>üí∞ For Cost Efficiency (Reduce False Alarms):</strong>
                        <p style="margin: 8px 0 0 0; color: #666;">Choose the model with highest <strong>Precision</strong> - minimizes unnecessary maintenance.</p>
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #2196f3;">
                        <strong>‚öñÔ∏è For Balanced Performance:</strong>
                        <p style="margin: 8px 0 0 0; color: #666;">Choose the model with highest <strong>F1-Score</strong> - best overall balance.</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #9c27b0;">
                        <strong>üéØ For Best Discrimination:</strong>
                        <p style="margin: 8px 0 0 0; color: #666;">Choose the model with highest <strong>AUC-ROC</strong> - best at ranking risk levels.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Model Info -->
        <div id="model" class="tab-content">
            <div class="grid">
                <div class="card" style="grid-column: span 2;">
                    <h2>ü§ñ Model Information</h2>
                    <table>
                        <tr>
                            <th>Property</th>
                            <th>Value</th>
                        </tr>
                        <tr>
                            <td>Model Type</td>
                            <td id="model-info-type">--</td>
                        </tr>
                        <tr>
                            <td>Model Loaded</td>
                            <td id="model-info-loaded">--</td>
                        </tr>
                        <tr>
                            <td>Features Count</td>
                            <td id="model-info-features">--</td>
                        </tr>
                        <tr>
                            <td>Sequence Length</td>
                            <td id="model-info-sequence">--</td>
                        </tr>
                        <tr>
                            <td>Total Parameters</td>
                            <td id="model-info-params">--</td>
                        </tr>
                    </table>
                </div>

                <div class="card" style="grid-column: span 2;">
                    <h2>üìà Model Performance Metrics</h2>
                    <table>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                            <th>Interpretation</th>
                        </tr>
                        <tr>
                            <td><strong>Recall</strong></td>
                            <td id="model-metric-recall">--</td>
                            <td>% of failures caught (MOST IMPORTANT)</td>
                        </tr>
                        <tr>
                            <td><strong>F1-Score</strong></td>
                            <td id="model-metric-f1">--</td>
                            <td>Balanced performance</td>
                        </tr>
                        <tr>
                            <td>Precision</td>
                            <td id="model-metric-precision">--</td>
                            <td>% of alerts that are real</td>
                        </tr>
                        <tr>
                            <td>Accuracy</td>
                            <td id="model-metric-accuracy">--</td>
                        </tr>
                        <tr>
                            <td>AUC</td>
                            <td id="model-metric-auc">--</td>
                            <td>Overall discrimination ability</td>
                        </tr>
                    </table>
                </div>

                <div class="card" style="grid-column: span 2;">
                    <h2>‚ú® Model Improvements</h2>
                    <div id="model-improvements">
                        <p style="color: #666;">Loading improvements...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';
        let refreshInterval = 15; // seconds
        let countdown = refreshInterval;
        let countdownTimer;
        let refreshTimer;
        let firstLoad = true;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'analytics') {
                updateAnalytics();
            } else if (tabName === 'model') {
                updateModelInfo();
            } else if (tabName === 'comparison') {
                updateModelComparison();
            }
        }

        // Update dashboard
        async function updateDashboard() {
            try {
                // Advance simulation to next timestep (skip on first load)
                if (!firstLoad) {
                    const advanceRes = await fetch(`${API_BASE}/api/simulation/advance`, { method: 'POST' });
                    const advanceData = await advanceRes.json();
                    // Update data index
                    document.getElementById('data-index').textContent =
                        advanceData.current_index.toLocaleString();
                }
                firstLoad = false;

                // Fetch status and prediction
                const [statusRes, predRes] = await Promise.all([
                    fetch(`${API_BASE}/api/vehicle/status`),
                    fetch(`${API_BASE}/api/predict`)
                ]);

                const status = await statusRes.json();
                const pred = await predRes.json();

                // Update timestamp
                document.getElementById('timestamp').textContent =
                    `Last Updated: ${new Date().toLocaleTimeString()}`;

                // Update battery
                document.getElementById('voltage').textContent =
                    `${status.battery.voltage.toFixed(2)} V`;
                document.getElementById('current').textContent =
                    `${status.battery.current.toFixed(2)} A`;
                document.getElementById('temperature').textContent =
                    `${status.battery.temperature.toFixed(1)} ¬∞C`;
                document.getElementById('soc').textContent =
                    `${(status.battery.soc * 100).toFixed(1)}%`;
                document.getElementById('soh').textContent =
                    `${(status.battery.soh * 100).toFixed(1)}%`;

                // Update health
                document.getElementById('health').textContent =
                    `${(status.health.component_health_score * 100).toFixed(1)}%`;
                document.getElementById('failure-prob').textContent =
                    `${(status.health.failure_probability * 100).toFixed(1)}%`;
                document.getElementById('rul').textContent =
                    `${status.health.rul_days.toFixed(1)} days`;

                // Maintenance type
                const maintTypes = ['None', 'Preventive', 'Corrective', 'Predictive'];
                document.getElementById('maint-type').textContent =
                    maintTypes[status.maintenance_type] || 'None';

                // Update vehicle
                document.getElementById('distance').textContent =
                    `${status.vehicle.distance_traveled.toFixed(1)} km`;
                document.getElementById('power').textContent =
                    `${status.vehicle.power_consumption.toFixed(2)} kWh`;
                document.getElementById('speed').textContent =
                    `${status.vehicle.driving_speed.toFixed(1)} km/h`;
                document.getElementById('cycles').textContent =
                    `${status.vehicle.charge_cycles}`;

                // Update prediction
                const probability = pred.prediction.probability;
                const severity = pred.prediction.severity;

                document.getElementById('pred-prob').textContent =
                    `${(probability * 100).toFixed(1)}%`;
                document.getElementById('threshold').textContent =
                    `${(pred.prediction.threshold * 100).toFixed(0)}%`;
                document.getElementById('confidence').textContent =
                    pred.prediction.confidence.toUpperCase();
                document.getElementById('severity').textContent =
                    severity;

                // Update cost analysis
                if (pred.prediction.cost_analysis) {
                    const cost = pred.prediction.cost_analysis;
                    document.getElementById('cost-preventive').textContent =
                        `$${cost.preventive_maintenance_cost.toFixed(0)}`;
                    document.getElementById('cost-no-action').textContent =
                        `$${cost.expected_cost_if_no_action.toFixed(0)}`;

                    const savings = cost.potential_savings;
                    const savingsText = savings > 0 ?
                        `$${savings.toFixed(0)} saved!` :
                        `$${Math.abs(savings).toFixed(0)} loss`;
                    document.getElementById('cost-savings').textContent = savingsText;
                    document.getElementById('cost-savings').style.color =
                        savings > 0 ? '#009900' : '#cc0000';

                    document.getElementById('cost-recommendation').textContent =
                        cost.action_recommendation;
                }

                // Update alert box
                const alertBox = document.getElementById('prediction-alert');
                alertBox.textContent = pred.prediction.recommendation;

                if (severity === 'CRITICAL') {
                    alertBox.className = 'alert alert-critical';
                } else if (severity === 'WARNING') {
                    alertBox.className = 'alert alert-warning';
                } else if (severity === 'MONITOR') {
                    alertBox.className = 'alert alert-monitor';
                } else {
                    alertBox.className = 'alert alert-success';
                }

                // Reset countdown
                countdown = refreshInterval;

            } catch (error) {
                console.error('Error updating dashboard:', error);
                document.getElementById('timestamp').textContent =
                    `Error: ${error.message}`;
            }
        }

        // Update analytics
        async function updateAnalytics() {
            try {
                const res = await fetch(`${API_BASE}/api/analytics`);
                const data = await res.json();
                const analytics = data.analytics;

                // Progress
                document.getElementById('analytics-total').textContent =
                    analytics.total_records.toLocaleString();
                document.getElementById('analytics-index').textContent =
                    analytics.current_index.toLocaleString();

                const progress = analytics.progress_percent.toFixed(1);
                document.getElementById('analytics-progress').style.width = `${progress}%`;
                document.getElementById('analytics-progress').textContent = `${progress}%`;

                // Battery stats
                document.getElementById('analytics-voltage').textContent =
                    `${analytics.battery_stats.avg_voltage.toFixed(2)} V`;
                document.getElementById('analytics-temp').textContent =
                    `${analytics.battery_stats.avg_temperature.toFixed(1)} ¬∞C`;
                document.getElementById('analytics-soc').textContent =
                    `${(analytics.battery_stats.avg_soc * 100).toFixed(1)}%`;
                document.getElementById('analytics-soh').textContent =
                    `${(analytics.battery_stats.avg_soh * 100).toFixed(1)}%`;

                // Health stats
                document.getElementById('analytics-health').textContent =
                    `${(analytics.health_stats.avg_component_health * 100).toFixed(1)}%`;
                document.getElementById('analytics-fail-prob').textContent =
                    `${(analytics.health_stats.avg_failure_probability * 100).toFixed(1)}%`;
                document.getElementById('analytics-rul').textContent =
                    `${analytics.health_stats.avg_rul.toFixed(1)} days`;

                // Maintenance events
                document.getElementById('analytics-total-events').textContent =
                    analytics.maintenance_events.total;
                document.getElementById('analytics-preventive').textContent =
                    analytics.maintenance_events.preventive;
                document.getElementById('analytics-corrective').textContent =
                    analytics.maintenance_events.corrective;
                document.getElementById('analytics-predictive').textContent =
                    analytics.maintenance_events.predictive;

                // Prediction stats
                document.getElementById('analytics-pred-count').textContent =
                    analytics.prediction_stats.total_predictions;
                document.getElementById('analytics-avg-prob').textContent =
                    `${(analytics.prediction_stats.avg_probability * 100).toFixed(1)}%`;
                document.getElementById('analytics-high-risk').textContent =
                    analytics.prediction_stats.high_risk_count;

            } catch (error) {
                console.error('Error updating analytics:', error);
            }
        }

        // Update model info
        async function updateModelInfo() {
            try {
                const res = await fetch(`${API_BASE}/api/model/info`);
                const info = await res.json();

                console.log('Model info:', info); // Debug

                document.getElementById('model-info-type').textContent =
                    info.model_type || 'Unknown';
                document.getElementById('model-info-loaded').textContent =
                    info.model_loaded ? 'Yes' : 'No';
                document.getElementById('model-info-features').textContent =
                    info.feature_count || 0;
                document.getElementById('model-info-sequence').textContent =
                    (info.sequence_length || 24) + ' timesteps (6 hours)';
                document.getElementById('model-info-params').textContent =
                    ((info.metrics && info.metrics.total_parameters) || 0).toLocaleString();

                // Model type header
                document.getElementById('model-type').textContent =
                    info.model_type || 'Unknown';

                // Metrics - check if metrics exist
                if (info.metrics) {
                    const metrics = info.metrics;
                    document.getElementById('model-metric-accuracy').textContent =
                        `${((metrics.accuracy || 0) * 100).toFixed(2)}%`;
                    document.getElementById('model-metric-precision').textContent =
                        `${((metrics.precision || 0) * 100).toFixed(2)}%`;

                    const recall = metrics.recall || 0;
                    let recallText = `${(recall * 100).toFixed(2)}%`;
                    if (recall >= 0.9) recallText += ' (Excellent!)';
                    document.getElementById('model-metric-recall').textContent = recallText;

                    document.getElementById('model-metric-f1').textContent =
                        `${((metrics.f1_score || 0) * 100).toFixed(2)}%`;
                    document.getElementById('model-metric-auc').textContent =
                        (metrics.auc || 0).toFixed(4);
                } else {
                    // Set defaults if no metrics
                    document.getElementById('model-metric-accuracy').textContent = 'N/A';
                    document.getElementById('model-metric-precision').textContent = 'N/A';
                    document.getElementById('model-metric-recall').textContent = 'N/A';
                    document.getElementById('model-metric-f1').textContent = 'N/A';
                    document.getElementById('model-metric-auc').textContent = 'N/A';
                }

                // Improvements
                const improvements = info.improvements || [];
                const improvementsHtml = improvements.length > 0 ?
                    '<ul style="list-style: none; padding: 0;">' + improvements.map(imp =>
                        `<li style="padding: 10px; border-left: 3px solid #667eea; margin: 10px 0; background: #f9f9f9;">
                            + ${imp}
                        </li>`
                    ).join('') + '</ul>' :
                    '<p style="color: #999;">No improvements listed</p>';
                document.getElementById('model-improvements').innerHTML = improvementsHtml;

            } catch (error) {
                console.error('Error updating model info:', error);
                document.getElementById('model-type').textContent = 'Error loading model';
            }
        }

        // Manual prediction form
        document.getElementById('manual-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);

            try {
                const res = await fetch(`${API_BASE}/api/predict/manual`, {
                    method: 'POST',
                    body: formData
                });

                const result = await res.json();
                const pred = result.prediction;

                // Show result
                document.getElementById('manual-result').style.display = 'block';

                // Update values
                document.getElementById('manual-prob').textContent =
                    `${(pred.probability * 100).toFixed(2)}%`;
                document.getElementById('manual-needed').textContent =
                    pred.maintenance_needed ? '‚úì YES' : '‚úó NO';
                document.getElementById('manual-severity').textContent =
                    pred.severity;
                document.getElementById('manual-confidence').textContent =
                    pred.confidence.toUpperCase();
                document.getElementById('manual-recommendation').textContent =
                    pred.recommendation;

                // Update cost analysis
                if (pred.cost_analysis) {
                    const cost = pred.cost_analysis;
                    document.getElementById('manual-cost-preventive').textContent =
                        `$${cost.preventive_maintenance_cost.toFixed(0)}`;
                    document.getElementById('manual-cost-no-action').textContent =
                        `$${cost.expected_cost_if_no_action.toFixed(0)}`;

                    const savings = cost.potential_savings;
                    const savingsText = savings > 0 ?
                        `$${savings.toFixed(0)} saved!` :
                        `$${Math.abs(savings).toFixed(0)} loss`;
                    document.getElementById('manual-cost-savings').textContent = savingsText;
                    document.getElementById('manual-cost-savings').style.color =
                        savings > 0 ? '#009900' : '#cc0000';

                    document.getElementById('manual-cost-recommendation').textContent =
                        cost.action_recommendation;
                }

                // Update alert
                const alertBox = document.getElementById('manual-alert');
                alertBox.textContent = pred.recommendation;

                if (pred.severity === 'CRITICAL') {
                    alertBox.className = 'alert alert-critical';
                } else if (pred.severity === 'WARNING') {
                    alertBox.className = 'alert alert-warning';
                } else if (pred.severity === 'MONITOR') {
                    alertBox.className = 'alert alert-monitor';
                } else {
                    alertBox.className = 'alert alert-success';
                }

                // Scroll to result
                document.getElementById('manual-result').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });

            } catch (error) {
                alert('Error making prediction: ' + error.message);
            }
        });

        // Countdown timer
        function updateCountdown() {
            document.getElementById('countdown').textContent = countdown;
            countdown--;

            if (countdown < 0) {
                countdown = refreshInterval;
                updateDashboard();
            }
        }

        // Update model comparison
        async function updateModelComparison() {
            try {
                // Fetch comparison data from API
                const res = await fetch(`${API_BASE}/api/model/comparison`);
                const data = await res.json();

                if (data.status === 'no_models') {
                    document.getElementById('comparison-table-body').innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; color: #ff6b6b;">
                                ‚ö†Ô∏è ${data.message}
                            </td>
                        </tr>
                    `;
                    document.getElementById('comparison-summary-text').textContent = data.message;
                    return;
                }

                // Format models for display
                const models = data.models.map(model => ({
                    name: model.name,
                    accuracy: (model.accuracy * 100).toFixed(2),
                    precision: (model.precision * 100).toFixed(2),
                    recall: (model.recall * 100).toFixed(2),
                    f1: (model.f1_score * 100).toFixed(2),
                    auc: model.auc_roc.toFixed(4),
                    params: model.parameters.toLocaleString()
                }));

                // Update table
                const tbody = document.getElementById('comparison-table-body');
                tbody.innerHTML = models.map(model => `
                    <tr>
                        <td><strong>${model.name}</strong></td>
                        <td>${model.accuracy}%</td>
                        <td>${model.precision}%</td>
                        <td>${model.recall}%</td>
                        <td>${model.f1}%</td>
                        <td>${model.auc}</td>
                        <td>${model.params}</td>
                    </tr>
                `).join('');

                // Update summary from API
                const summaryLines = Object.values(data.summary);
                const summaryText = summaryLines.map(line =>
                    `<div style="margin: 8px 0;">${line}</div>`
                ).join('');
                document.getElementById('comparison-summary-text').innerHTML = summaryText;

            } catch (error) {
                console.error('Error loading comparison data:', error);
                document.getElementById('comparison-table-body').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #ff6b6b;">
                            ‚ö†Ô∏è Error: ${error.message}. Make sure the API server is running.
                        </td>
                    </tr>
                `;
                document.getElementById('comparison-summary-text').innerHTML =
                    `<span style="color: #ff6b6b;">Error loading data: ${error.message}</span>`;
            }
        }

        // Initialize
        async function init() {
            // Fetch initial analytics to get current index
            const analyticsRes = await fetch(`${API_BASE}/api/analytics`);
            const analyticsData = await analyticsRes.json();
            document.getElementById('data-index').textContent =
                analyticsData.analytics.current_index.toLocaleString();

            await updateDashboard();
            await updateModelInfo();

            // Start countdown
            countdownTimer = setInterval(updateCountdown, 1000);
        }

        // Start
        init();
    </script>
</body>
</html>
